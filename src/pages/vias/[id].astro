---
import Layout from '../../layouts/Layout.astro';
import LightboxGallery from '../../components/LightboxGallery.astro';
import { projects } from '../../data/vias';
import { Image } from 'astro:assets'; // Importar el componente Image de Astro

export async function getStaticPaths() {
  return projects.map(project => ({
    params: { id: project.id },
  }));
}

const { id } = Astro.params;
const project = projects.find(p => p.id === id);

if (!project) {
  return Astro.redirect('/404'); // O manejar el error de otra manera
}

const { title, body: description, imageGallery } = project;

const imageFiles = imageGallery.map(src => ({
  src,
  caption: `Imagen de ${title}` // Placeholder caption
}));
---

<Layout title={title} description={description}>
  <div class="container mx-auto px-4 py-16">
    <a href="/vias" class="text-primary hover:underline mb-8 inline-block">&larr; Volver a Infraestructura Vial</a>
    
    <h1 class="text-4xl font-bold text-text-dark mb-4">{title}</h1>
    <p class="text-lg text-text-dark mb-12 leading-relaxed">{description}</p>

    <h2 class="text-3xl font-bold text-center mb-8 text-text-dark">Galería de Imágenes</h2>
    
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-12">
      {imageFiles.map((image, index) => (
        <div class="relative group cursor-pointer" onclick={`window.myProjectScripts.openLightbox(${index}, ${JSON.stringify(imageFiles)}, '${title}')`}>
          <Image 
            src={image.src} 
            alt={image.caption} 
            width={600}
            height={400}
            class="w-full h-auto object-contain rounded-lg shadow-md transition-transform duration-300 group-hover:scale-105"
            loading="lazy"
            decoding="async"
          />
          <div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-lg">
            <span class="text-white text-xl font-semibold">{image.caption}</span>
          </div>
        </div>
      ))}
    </div>

    <LightboxGallery projectImages={imageFiles} projectTitle={title} />
  </div>
</Layout>
