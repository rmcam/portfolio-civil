---
import Layout from '../../layouts/Layout.astro';
import LightboxGallery from '../../components/LightboxGallery.astro';
import fs from 'fs';
import path from 'path';

export async function getStaticPaths() {
const projectsDir = path.resolve('public/Infraestructura-Vial');
  const projectFolders = fs.readdirSync(projectsDir).filter(file => 
    fs.statSync(path.join(projectsDir, file)).isDirectory()
  );

  return projectFolders.map(id => ({
    params: { id },
  }));
}

const { id } = Astro.params;

const projectDir = path.resolve(`public/Infraestructura-Vial/${id}`);

interface ProjectDetail {
  title: string;
  description: string;
}

const projectDetails: { [key: string]: ProjectDetail } = {
  '1': {
    title: "Mejoramiento de Vías Urbanas en Solita, Caquetá",
    description: "Este proyecto se centró en la renovación de la infraestructura vial del municipio de Solita, mediante la construcción de pavimento hidráulico de alta durabilidad y la ejecución de obras complementarias esenciales para garantizar la seguridad y mejorar el flujo vehicular en la zona.",
  },
  '2': {
    title: "Pavimentación en Solita y Valparaíso, Caquetá",
    description: "Se llevó a cabo el mejoramiento de vías urbanas clave en los municipios de Solita y Valparaíso. El proyecto incluyó la pavimentación con concreto hidráulico y la realización de obras complementarias para modernizar la infraestructura y beneficiar a ambas comunidades.",
  },
  '3': {
    title: "Pavimentación en C.P. Versalles, Albania",
    description: "El proyecto consistió en el mejoramiento de una vía urbana principal en el centro poblado de Versalles, municipio de Albania, utilizando pavimentación de concreto rígido para asegurar una solución vial de larga duración y bajo mantenimiento, mejorando la calidad de vida de los residentes.",
  }
};

const details = projectDetails[id] || { title: "Proyecto Vial", description: "Descripción no disponible." };
const { title, description } = details;

const imageFiles = fs.readdirSync(projectDir)
  .filter(file => file.endsWith('.webp'))
  .map(file => ({
    src: `/Infraestructura-Vial/${id}/${file}`,
    caption: `Imagen de ${title}` // Placeholder caption
  }));
---

<Layout title={title} description={description}>
  <div class="container mx-auto px-4 py-16">
    <a href="/vias" class="text-primary hover:underline mb-8 inline-block">&larr; Volver a Infraestructura Vial</a>
    
    <h1 class="text-4xl font-bold text-text-dark mb-4">{title}</h1>
    <p class="text-lg text-text-dark mb-12 leading-relaxed">{description}</p>

    <h2 class="text-3xl font-bold text-center mb-8 text-text-dark">Galería de Imágenes</h2>
    <LightboxGallery images={imageFiles} projectTitle={title} />
  </div>
</Layout>
